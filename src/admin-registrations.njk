---
layout: base
title: Registrations
permalink: /admin/registrations/index.html
---
<section class="container py-12">
  <h1 class="text-3xl font-bold mb-6">Lesson Registrations</h1>
  <p class="text-sm mb-4">You must be logged in (admin) via Netlify Identity for this to work.</p>
  <div class="mb-6 flex gap-3 items-end flex-wrap">
    <label class="block text-sm">Filter slug
      <input id="filter-slug" class="border rounded px-2 py-1" placeholder="optional" />
    </label>
    <button id="load" class="btn">Load</button>
    <button id="export" class="btn">Export CSV</button>
  </div>
  <div id="status" class="text-sm text-gray-600 mb-4">Idle</div>
  <div class="overflow-auto">
    <table class="min-w-full text-sm" id="table">
      <thead>
        <tr class="border-b">
          <th class="text-left py-2 pr-4">Lesson Slug</th>
          <th class="text-left py-2 pr-4">Name</th>
          <th class="text-left py-2 pr-4">Email</th>
          <th class="text-left py-2 pr-4">Registered At</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>
<script>
async function load(){
  const slug = document.getElementById('filter-slug').value.trim();
  const status = document.getElementById('status');
  status.textContent = 'Loadingâ€¦';
  const url = slug ? `/api/admin/registrations?slug=${encodeURIComponent(slug)}` : '/api/admin/registrations';
  try {
    const res = await fetch(url, { headers: { 'Accept': 'application/json' }});
    const data = await res.json();
    if(!res.ok) throw new Error(data.error || 'Error');
    const tbody = document.querySelector('#table tbody');
    tbody.innerHTML = '';
    data.forEach(r => {
      const tr = document.createElement('tr');
      tr.className = 'border-b last:border-b-0';
      tr.innerHTML = `<td class='py-1 pr-4 font-mono text-xs'>${r.lesson_slug}</td><td class='py-1 pr-4'>${r.name}</td><td class='py-1 pr-4'>${r.email}</td><td class='py-1 pr-4'>${new Date(r.created_at).toLocaleString()}</td>`;
      tbody.appendChild(tr);
    });
    status.textContent = `${data.length} registrations loaded.`;
  } catch(err){
    status.textContent = err.message;
  }
}

document.getElementById('load').addEventListener('click', load);

document.getElementById('export').addEventListener('click', () => {
  const slug = document.getElementById('filter-slug').value.trim();
  const url = slug ? `/api/admin/export-registrations?slug=${encodeURIComponent(slug)}` : '/api/admin/export-registrations';
  window.location = url;
});
</script>
